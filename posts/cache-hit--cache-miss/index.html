<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Các chính sách 'Dọn Dẹp' Cache | Nagih | Blog</title>
<meta name=keywords content="cache"><meta name=description content="Chúng ta đã biết cache rất hữu ích, nhưng nó có một giới hạn cố hữu: dung lượng nhỏ. Bộ nhớ tốc độ cao (như RAM) rất đắt đỏ, vì vậy cache không thể lưu trữ mọi thứ."><meta name=author content="Nagih"><link rel=canonical href=https://blog.nagih.io.vn/posts/cache-hit--cache-miss/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.08f7d74f0ada0f975d29ae436285b61ed7a719d05f350cb888d00341642995a2.css integrity="sha256-CPfXTwraD5ddKa5DYoW2HtenGdBfNQy4iNADQWQplaI=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.nagih.io.vn/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://blog.nagih.io.vn/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://blog.nagih.io.vn/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://blog.nagih.io.vn/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://blog.nagih.io.vn/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.nagih.io.vn/posts/cache-hit--cache-miss/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://blog.nagih.io.vn/posts/cache-hit--cache-miss/"><meta property="og:site_name" content="Nagih | Blog"><meta property="og:title" content="Các chính sách 'Dọn Dẹp' Cache"><meta property="og:description" content="Chúng ta đã biết cache rất hữu ích, nhưng nó có một giới hạn cố hữu: dung lượng nhỏ. Bộ nhớ tốc độ cao (như RAM) rất đắt đỏ, vì vậy cache không thể lưu trữ mọi thứ."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-08-10T00:00:00+00:00"><meta property="article:modified_time" content="2025-08-10T00:00:00+00:00"><meta property="article:tag" content="Cache"><meta property="og:image" content="https://blog.nagih.io.vn/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.nagih.io.vn/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Các chính sách 'Dọn Dẹp' Cache"><meta name=twitter:description content="Chúng ta đã biết cache rất hữu ích, nhưng nó có một giới hạn cố hữu: dung lượng nhỏ. Bộ nhớ tốc độ cao (như RAM) rất đắt đỏ, vì vậy cache không thể lưu trữ mọi thứ."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.nagih.io.vn/posts/"},{"@type":"ListItem","position":2,"name":"Các chính sách 'Dọn Dẹp' Cache","item":"https://blog.nagih.io.vn/posts/cache-hit--cache-miss/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Các chính sách 'Dọn Dẹp' Cache","name":"Các chính sách \u0027Dọn Dẹp\u0027 Cache","description":"Chúng ta đã biết cache rất hữu ích, nhưng nó có một giới hạn cố hữu: dung lượng nhỏ. Bộ nhớ tốc độ cao (như RAM) rất đắt đỏ, vì vậy cache không thể lưu trữ mọi thứ.\n","keywords":["cache"],"articleBody":"Chúng ta đã biết cache rất hữu ích, nhưng nó có một giới hạn cố hữu: dung lượng nhỏ. Bộ nhớ tốc độ cao (như RAM) rất đắt đỏ, vì vậy cache không thể lưu trữ mọi thứ.\nCác Chính Sách “Dọn Dẹp” Chúng ta đã biết cache rất hữu ích, nhưng nó có một giới hạn cố hữu: dung lượng nhỏ. Bộ nhớ tốc độ cao (như RAM) rất đắt đỏ, vì vậy cache không thể lưu trữ mọi thứ.\nĐiều này dẫn đến một vấn đề không thể tránh khỏi: khi cache đã đầy và một mục dữ liệu mới cần được thêm vào, hệ thống phải quyết định loại bỏ một mục dữ liệu cũ để nhường chỗ. Quá trình này được gọi là Eviction.\nThuật toán được sử dụng để quyết định mục nào sẽ bị loại bỏ được gọi là Chính sách dọn dẹp (Eviction Policy).\nCác chiến lược dọn dẹp phổ biến FIFO (First-In, First-Out - Vào trước, Ra trước):\nNguyên tắc: Nó loại bỏ mục dữ liệu cũ nhất, bất kể nó có được sử dụng thường xuyên hay không. Nó hoạt động giống như một hàng đợi (queue).\nƯu điểm: Rất dễ cài đặt và có chi phí quản lý thấp.\nNhược điểm: Thường không hiệu quả vì nó có thể loại bỏ một mục rất phổ biến chỉ vì nó được nạp vào cache từ lâu.\nLRU (Least Recently Used - Ít được sử dụng gần đây nhất):\nNguyên tắc: Loại bỏ mục dữ liệu mà đã không được truy cập trong khoảng thời gian dài nhất.\nƯu điểm: Hiệu quả hơn FIFO rất nhiều trong hầu hết các trường hợp thực tế, vì nó giữ lại những dữ liệu đang được sử dụng tích cực.\nNhược điểm: Phức tạp hơn trong việc triển khai vì nó đòi hỏi phải theo dõi thời gian truy cập của mỗi mục, gây tốn thêm một chút bộ nhớ và xử lý.\nLFU (Least Frequently Used - Ít được sử dụng thường xuyên nhất):\nNguyên tắc: Loại bỏ mục dữ liệu được truy cập với số lần ít nhất.\nƯu điểm: Rất tốt trong việc xác định và giữ lại các mục dữ liệu “hot” (phổ biến) trong một thời gian dài, ngay cả khi chúng không được truy cập gần đây.\nNhược điểm: Phức tạp để triển khai hiệu quả. (ví dụ: một mục từng rất hot nhưng giờ không còn ai dùng nữa vẫn có thể chiếm chỗ trong cache một thời gian dài). Nó cũng có thể loại bỏ một mục mới được thêm vào nhưng chưa có cơ hội tích lũy đủ số lần truy cập.\nBảng so sánh các chính sách dọn dẹp Chính sách Nguyên tắc cốt lõi Ví dụ tương tự Ưu điểm Nhược điểm Phù hợp nhất cho FIFO Loại bỏ mục vào cache sớm nhất. Xếp hàng mua vé: người đến trước được phục vụ trước. Đơn giản, chi phí thấp. Không thông minh, có thể loại bỏ dữ liệu quan trọng. Các hệ thống có mẫu truy cập tuần tự, không lặp lại. LRU Loại bỏ mục ít được dùng đến gần đây nhất. Dọn dẹp bàn làm việc: trả lại cuốn sách bạn không đụng đến lâu nhất. Hiệu quả cao trong hầu hết các trường hợp, thích ứng tốt với sự thay đổi. Phức tạp hơn, cần theo dõi thời gian truy cập. Các ứng dụng thông thường, nơi dữ liệu gần đây có khả năng được tái sử dụng cao (ví dụ: trang tin tức, mạng xã hội). LFU Loại bỏ mục có số lần truy cập ít nhất. Thư viện cho mượn sách: loại bỏ những cuốn ít người mượn nhất. Giữ lại được các mục “hot” một cách ổn định. Phức tạp, có thể giữ lại dữ liệu “hot” đã lỗi thời, không thích ứng nhanh. Các hệ thống có một số dữ liệu cực kỳ phổ biến và ổn định (ví dụ: sản phẩm bán chạy, video viral). Giữ Cho Dữ Liệu Đồng Nhất: Các Chính Sách Ghi Khi một ứng dụng thực hiện thao tác ghi (write) hoặc cập nhật (update), một vấn đề nghiêm trọng nảy sinh. Bây giờ chúng ta có hai bản sao của cùng một dữ liệu: một trong cache và một trong cơ sở dữ liệu. Nếu chúng không được cập nhật đồng bộ, cache sẽ chứa dữ liệu cũ. Việc phục vụ stale data cho người dùng có thể dẫn đến các lỗi nghiêm trọng, thông tin sai lệch và trải nghiệm tồi tệ.\nChính sách ghi (Write Policy) là quy tắc xác định cách hệ thống xử lý các thao tác ghi để giải quyết vấn đề về tính nhất quán này.\nCác chính sách ghi cốt lõi Write-Through (Ghi Xuyên)\nQuy trình: Khi ứng dụng ghi dữ liệu, nó sẽ ghi đồng thời vào cả cache và cơ sở dữ liệu. Thao tác chỉ được coi là hoàn tất khi cả hai nơi đều đã ghi xong.\nLưu đồ: Ứng dụng -\u003e Ghi vào Cache -\u003e Ghi vào Database -\u003e Hoàn tất\nƯu điểm: Tính nhất quán dữ liệu rất cao. Cache và database luôn đồng bộ. Đơn giản để triển khai và đáng tin cậy.\nNhược điểm: Độ trễ của thao tác ghi cao, vì ứng dụng phải chờ cả hai thao tác ghi hoàn tất.\nTrường hợp sử dụng: Các ứng dụng quan trọng nơi tính nhất quán dữ liệu là tối thượng, ví dụ như hệ thống ngân hàng, quản lý kho hàng.\nWrite-Back (Ghi Sau / Write-Behind)\nQuy trình: Khi ứng dụng ghi dữ liệu, nó chỉ ghi vào cache tốc độ cao trước. Thao tác được xác nhận hoàn tất ngay lập tức. Việc ghi vào cơ sở dữ liệu sẽ được trì hoãn và thực hiện sau đó, có thể là sau một khoảng thời gian nhất định hoặc khi mục cache đó sắp bị dọn dẹp. Hệ thống thường dùng một “bit bẩn” (dirty bit) để đánh dấu các mục trong cache đã bị thay đổi và cần được ghi lại vào database.\nLưu đồ: Ứng dụng -\u003e Ghi vào Cache -\u003e Hoàn tất. (Background: Cache -\u003e Ghi vào Database)\nƯu điểm: Độ trễ ghi cực thấp và thông lượng cao. Giảm tải cho database bằng cách gộp nhiều lần ghi vào cùng một đối tượng thành một lần ghi duy nhất (write-coalescing).\nNhược điểm: Có nguy cơ mất dữ liệu nếu cache bị lỗi trước khi dữ liệu kịp ghi vào database. Phức tạp hơn để triển khai.\nTrường hợp sử dụng: Các ứng dụng có lượng ghi lớn, nơi hiệu năng là ưu tiên hàng đầu và có thể chấp nhận một rủi ro nhỏ về mất mát dữ liệu, ví dụ như ghi log hành vi người dùng, cập nhật số lượt xem bài viết.\nWrite-Around (Ghi Vòng)\nQuy trình: Khi ứng dụng ghi dữ liệu, nó sẽ ghi trực tiếp vào cơ sở dữ liệu, hoàn toàn bỏ qua cache. Dữ liệu chỉ được nạp vào cache sau này, khi có một yêu cầu đọc bị cache miss.\nLưu đồ: Ứng dụng -\u003e Ghi vào Database -\u003e Hoàn tất\nƯu điểm: Tránh “làm ô nhiễm” cache bằng những dữ liệu có thể không bao giờ được đọc lại.\nNhược điểm: Một yêu cầu đọc ngay sau khi ghi sẽ luôn luôn là cache miss, dẫn đến độ trễ đọc cao cho dữ liệu vừa được ghi.\nTrường hợp sử dụng: Các ứng dụng ghi dữ liệu nhưng hiếm khi đọc lại ngay sau đó, ví dụ như các hệ thống nhập dữ liệu hàng loạt (bulk data ingestion), lưu trữ log.\nCác chính sách ghi không tồn tại một cách độc lập. Chúng liên kết chặt chẽ với cách hệ thống xử lý một write miss (khi ứng dụng muốn ghi vào một mục không có trong cache). Có hai lựa chọn:\nWrite Allocate (Fetch on Write): Khi có write miss, hệ thống sẽ tải khối dữ liệu đó từ database vào cache trước, rồi mới thực hiện thao tác ghi.\nNo-Write Allocate: Khi có write miss, hệ thống sẽ ghi thẳng vào database, không tải dữ liệu đó vào cache.\n","wordCount":"1373","inLanguage":"en","image":"https://blog.nagih.io.vn/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-08-10T00:00:00Z","dateModified":"2025-08-10T00:00:00Z","author":{"@type":"Person","name":"Nagih"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.nagih.io.vn/posts/cache-hit--cache-miss/"},"publisher":{"@type":"Organization","name":"Nagih | Blog","logo":{"@type":"ImageObject","url":"https://blog.nagih.io.vn/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.nagih.io.vn/ accesskey=h title="Home (Alt + H)"><img src=https://blog.nagih.io.vn/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.nagih.io.vn/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://blog.nagih.io.vn/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://blog.nagih.io.vn/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://blog.nagih.io.vn/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://nagih.io.vn title=Home><span>Home</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.nagih.io.vn/>Home</a>&nbsp;»&nbsp;<a href=https://blog.nagih.io.vn/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Các chính sách 'Dọn Dẹp' Cache</h1><div class=post-meta><span title='2025-08-10 00:00:00 +0000 UTC'>August 10, 2025</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;1373 words&nbsp;·&nbsp;Nagih&nbsp;|&nbsp;<a href=https://github.com/vuongmanhnghia/posts/content/posts/system/cache/Cache%20Hit%20&%20Cache%20Miss.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#các-chính-sách-dọn-dẹp>Các Chính Sách &ldquo;Dọn Dẹp&rdquo;</a><ul><li><a href=#các-chiến-lược-dọn-dẹp-phổ-biến>Các chiến lược dọn dẹp phổ biến</a></li><li><a href=#bảng-so-sánh-các-chính-sách-dọn-dẹp>Bảng so sánh các chính sách dọn dẹp</a></li></ul></li><li><a href=#giữ-cho-dữ-liệu-đồng-nhất-các-chính-sách-ghi>Giữ Cho Dữ Liệu Đồng Nhất: Các Chính Sách Ghi</a><ul><li><a href=#các-chính-sách-ghi-cốt-lõi>Các chính sách ghi cốt lõi</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>Chúng ta đã biết cache rất hữu ích, nhưng nó có một giới hạn cố hữu: dung lượng nhỏ. Bộ nhớ tốc độ cao (như RAM) rất đắt đỏ, vì vậy cache không thể lưu trữ mọi thứ.</p><hr><h2 id=các-chính-sách-dọn-dẹp>Các Chính Sách &ldquo;Dọn Dẹp&rdquo;<a hidden class=anchor aria-hidden=true href=#các-chính-sách-dọn-dẹp>#</a></h2><p>Chúng ta đã biết cache rất hữu ích, nhưng nó có một giới hạn cố hữu: dung lượng nhỏ. Bộ nhớ tốc độ cao (như RAM) rất đắt đỏ, vì vậy cache không thể lưu trữ mọi thứ.</p><p>Điều này dẫn đến một vấn đề không thể tránh khỏi: khi cache đã đầy và một mục dữ liệu mới cần được thêm vào, hệ thống phải quyết định loại bỏ một mục dữ liệu cũ để nhường chỗ. Quá trình này được gọi là <strong>Eviction</strong>.</p><p>Thuật toán được sử dụng để quyết định <em>mục nào</em> sẽ bị loại bỏ được gọi là <strong>Chính sách dọn dẹp (Eviction Policy)</strong>.</p><h3 id=các-chiến-lược-dọn-dẹp-phổ-biến>Các chiến lược dọn dẹp phổ biến<a hidden class=anchor aria-hidden=true href=#các-chiến-lược-dọn-dẹp-phổ-biến>#</a></h3><ul><li><p><strong>FIFO (First-In, First-Out - Vào trước, Ra trước):</strong></p><ul><li><p><strong>Nguyên tắc:</strong> Nó loại bỏ mục dữ liệu cũ nhất, bất kể nó có được sử dụng thường xuyên hay không. Nó hoạt động giống như một hàng đợi (queue).</p></li><li><p><strong>Ưu điểm:</strong> Rất dễ cài đặt và có chi phí quản lý thấp.</p></li><li><p><strong>Nhược điểm:</strong> Thường không hiệu quả vì nó có thể loại bỏ một mục rất phổ biến chỉ vì nó được nạp vào cache từ lâu.</p></li></ul></li><li><p><strong>LRU (Least Recently Used - Ít được sử dụng gần đây nhất):</strong></p><ul><li><p><strong>Nguyên tắc:</strong> Loại bỏ mục dữ liệu mà đã không được truy cập trong khoảng thời gian dài nhất.</p></li><li><p><strong>Ưu điểm:</strong> Hiệu quả hơn FIFO rất nhiều trong hầu hết các trường hợp thực tế, vì nó giữ lại những dữ liệu đang được sử dụng tích cực.</p></li><li><p><strong>Nhược điểm:</strong> Phức tạp hơn trong việc triển khai vì nó đòi hỏi phải theo dõi thời gian truy cập của mỗi mục, gây tốn thêm một chút bộ nhớ và xử lý.</p></li></ul></li><li><p><strong>LFU (Least Frequently Used - Ít được sử dụng thường xuyên nhất):</strong></p><ul><li><p><strong>Nguyên tắc:</strong> Loại bỏ mục dữ liệu được truy cập với số lần ít nhất.</p></li><li><p><strong>Ưu điểm:</strong> Rất tốt trong việc xác định và giữ lại các mục dữ liệu &ldquo;hot&rdquo; (phổ biến) trong một thời gian dài, ngay cả khi chúng không được truy cập gần đây.</p></li><li><p><strong>Nhược điểm:</strong> Phức tạp để triển khai hiệu quả. (ví dụ: một mục từng rất hot nhưng giờ không còn ai dùng nữa vẫn có thể chiếm chỗ trong cache một thời gian dài). Nó cũng có thể loại bỏ một mục mới được thêm vào nhưng chưa có cơ hội tích lũy đủ số lần truy cập.</p></li></ul></li></ul><h3 id=bảng-so-sánh-các-chính-sách-dọn-dẹp>Bảng so sánh các chính sách dọn dẹp<a hidden class=anchor aria-hidden=true href=#bảng-so-sánh-các-chính-sách-dọn-dẹp>#</a></h3><table><thead><tr><th>Chính sách</th><th>Nguyên tắc cốt lõi</th><th>Ví dụ tương tự</th><th>Ưu điểm</th><th>Nhược điểm</th><th>Phù hợp nhất cho</th></tr></thead><tbody><tr><td><strong>FIFO</strong></td><td>Loại bỏ mục vào cache sớm nhất.</td><td>Xếp hàng mua vé: người đến trước được phục vụ trước.</td><td>Đơn giản, chi phí thấp.</td><td>Không thông minh, có thể loại bỏ dữ liệu quan trọng.</td><td>Các hệ thống có mẫu truy cập tuần tự, không lặp lại.</td></tr><tr><td><strong>LRU</strong></td><td>Loại bỏ mục ít được dùng đến gần đây nhất.</td><td>Dọn dẹp bàn làm việc: trả lại cuốn sách bạn không đụng đến lâu nhất.</td><td>Hiệu quả cao trong hầu hết các trường hợp, thích ứng tốt với sự thay đổi.</td><td>Phức tạp hơn, cần theo dõi thời gian truy cập.</td><td>Các ứng dụng thông thường, nơi dữ liệu gần đây có khả năng được tái sử dụng cao (ví dụ: trang tin tức, mạng xã hội).</td></tr><tr><td><strong>LFU</strong></td><td>Loại bỏ mục có số lần truy cập ít nhất.</td><td>Thư viện cho mượn sách: loại bỏ những cuốn ít người mượn nhất.</td><td>Giữ lại được các mục &ldquo;hot&rdquo; một cách ổn định.</td><td>Phức tạp, có thể giữ lại dữ liệu &ldquo;hot&rdquo; đã lỗi thời, không thích ứng nhanh.</td><td>Các hệ thống có một số dữ liệu cực kỳ phổ biến và ổn định (ví dụ: sản phẩm bán chạy, video viral).</td></tr></tbody></table><h2 id=giữ-cho-dữ-liệu-đồng-nhất-các-chính-sách-ghi>Giữ Cho Dữ Liệu Đồng Nhất: Các Chính Sách Ghi<a hidden class=anchor aria-hidden=true href=#giữ-cho-dữ-liệu-đồng-nhất-các-chính-sách-ghi>#</a></h2><p>Khi một ứng dụng thực hiện thao tác ghi (write) hoặc cập nhật (update), một vấn đề nghiêm trọng nảy sinh. Bây giờ chúng ta có hai bản sao của cùng một dữ liệu: một trong cache và một trong cơ sở dữ liệu. Nếu chúng không được cập nhật đồng bộ, cache sẽ chứa dữ liệu cũ. Việc phục vụ stale data cho người dùng có thể dẫn đến các lỗi nghiêm trọng, thông tin sai lệch và trải nghiệm tồi tệ.</p><p><strong>Chính sách ghi (Write Policy)</strong> là quy tắc xác định cách hệ thống xử lý các thao tác ghi để giải quyết vấn đề về tính nhất quán này.</p><h3 id=các-chính-sách-ghi-cốt-lõi>Các chính sách ghi cốt lõi<a hidden class=anchor aria-hidden=true href=#các-chính-sách-ghi-cốt-lõi>#</a></h3><ul><li><p><strong>Write-Through (Ghi Xuyên)</strong></p><ul><li><p><strong>Quy trình:</strong> Khi ứng dụng ghi dữ liệu, nó sẽ ghi <strong>đồng thời</strong> vào cả cache và cơ sở dữ liệu. Thao tác chỉ được coi là hoàn tất khi cả hai nơi đều đã ghi xong.</p></li><li><p><strong>Lưu đồ:</strong> <code>Ứng dụng -> Ghi vào Cache -> Ghi vào Database -> Hoàn tất</code></p></li><li><p><strong>Ưu điểm:</strong> Tính nhất quán dữ liệu rất cao. Cache và database luôn đồng bộ. Đơn giản để triển khai và đáng tin cậy.</p></li><li><p><strong>Nhược điểm:</strong> Độ trễ của thao tác ghi cao, vì ứng dụng phải chờ cả hai thao tác ghi hoàn tất.</p></li><li><p><strong>Trường hợp sử dụng:</strong> Các ứng dụng quan trọng nơi tính nhất quán dữ liệu là tối thượng, ví dụ như hệ thống ngân hàng, quản lý kho hàng.</p></li></ul></li><li><p><strong>Write-Back (Ghi Sau / Write-Behind)</strong></p><ul><li><p><strong>Quy trình:</strong> Khi ứng dụng ghi dữ liệu, nó chỉ ghi vào cache tốc độ cao trước. Thao tác được xác nhận hoàn tất ngay lập tức. Việc ghi vào cơ sở dữ liệu sẽ được trì hoãn và thực hiện sau đó, có thể là sau một khoảng thời gian nhất định hoặc khi mục cache đó sắp bị dọn dẹp. Hệ thống thường dùng một &ldquo;bit bẩn&rdquo; (dirty bit) để đánh dấu các mục trong cache đã bị thay đổi và cần được ghi lại vào database.</p></li><li><p><strong>Lưu đồ:</strong> <code>Ứng dụng -> Ghi vào Cache -> Hoàn tất. (Background: Cache -> Ghi vào Database)</code></p></li><li><p><strong>Ưu điểm:</strong> Độ trễ ghi cực thấp và thông lượng cao. Giảm tải cho database bằng cách gộp nhiều lần ghi vào cùng một đối tượng thành một lần ghi duy nhất (write-coalescing).</p></li><li><p><strong>Nhược điểm:</strong> Có nguy cơ mất dữ liệu nếu cache bị lỗi trước khi dữ liệu kịp ghi vào database. Phức tạp hơn để triển khai.</p></li><li><p><strong>Trường hợp sử dụng:</strong> Các ứng dụng có lượng ghi lớn, nơi hiệu năng là ưu tiên hàng đầu và có thể chấp nhận một rủi ro nhỏ về mất mát dữ liệu, ví dụ như ghi log hành vi người dùng, cập nhật số lượt xem bài viết.</p></li></ul></li><li><p><strong>Write-Around (Ghi Vòng)</strong></p><ul><li><p><strong>Quy trình:</strong> Khi ứng dụng ghi dữ liệu, nó sẽ ghi <strong>trực tiếp</strong> vào cơ sở dữ liệu, hoàn toàn bỏ qua cache. Dữ liệu chỉ được nạp vào cache sau này, khi có một yêu cầu đọc bị cache miss.</p></li><li><p><strong>Lưu đồ:</strong> <code>Ứng dụng -> Ghi vào Database -> Hoàn tất</code></p></li><li><p><strong>Ưu điểm:</strong> Tránh &ldquo;làm ô nhiễm&rdquo; cache bằng những dữ liệu có thể không bao giờ được đọc lại.</p></li><li><p><strong>Nhược điểm:</strong> Một yêu cầu đọc ngay sau khi ghi sẽ luôn luôn là cache miss, dẫn đến độ trễ đọc cao cho dữ liệu vừa được ghi.</p></li><li><p><strong>Trường hợp sử dụng:</strong> Các ứng dụng ghi dữ liệu nhưng hiếm khi đọc lại ngay sau đó, ví dụ như các hệ thống nhập dữ liệu hàng loạt (bulk data ingestion), lưu trữ log.</p></li></ul></li></ul><p>Các chính sách ghi không tồn tại một cách độc lập. Chúng liên kết chặt chẽ với cách hệ thống xử lý một <strong>write miss</strong> (khi ứng dụng muốn ghi vào một mục không có trong cache). Có hai lựa chọn:</p><ol><li><p><strong>Write Allocate (Fetch on Write):</strong> Khi có write miss, hệ thống sẽ tải khối dữ liệu đó từ database vào cache trước, rồi mới thực hiện thao tác ghi.</p></li><li><p><strong>No-Write Allocate:</strong> Khi có write miss, hệ thống sẽ ghi thẳng vào database, không tải dữ liệu đó vào cache.</p></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.nagih.io.vn/tags/cache/>Cache</a></li></ul><nav class=paginav><a class=prev href=https://blog.nagih.io.vn/posts/9-mysql-table-design-rules--skills/><span class=title>« Prev</span><br><span>9 MySQL Table Design Rules & Skills</span>
</a><a class=next href=https://blog.nagih.io.vn/posts/cache-system-design/><span class=title>Next »</span><br><span>Các mẫu thiết kế, xây dựng hệ thống với Cache và chiến lược vô hiệu hóa Cache</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Các chính sách 'Dọn Dẹp' Cache on x" href="https://x.com/intent/tweet/?text=C%c3%a1c%20ch%c3%adnh%20s%c3%a1ch%20%27D%e1%bb%8dn%20D%e1%ba%b9p%27%20Cache&amp;url=https%3a%2f%2fblog.nagih.io.vn%2fposts%2fcache-hit--cache-miss%2f&amp;hashtags=cache"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Các chính sách 'Dọn Dẹp' Cache on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.nagih.io.vn%2fposts%2fcache-hit--cache-miss%2f&amp;title=C%c3%a1c%20ch%c3%adnh%20s%c3%a1ch%20%27D%e1%bb%8dn%20D%e1%ba%b9p%27%20Cache&amp;summary=C%c3%a1c%20ch%c3%adnh%20s%c3%a1ch%20%27D%e1%bb%8dn%20D%e1%ba%b9p%27%20Cache&amp;source=https%3a%2f%2fblog.nagih.io.vn%2fposts%2fcache-hit--cache-miss%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Các chính sách 'Dọn Dẹp' Cache on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.nagih.io.vn%2fposts%2fcache-hit--cache-miss%2f&title=C%c3%a1c%20ch%c3%adnh%20s%c3%a1ch%20%27D%e1%bb%8dn%20D%e1%ba%b9p%27%20Cache"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Các chính sách 'Dọn Dẹp' Cache on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.nagih.io.vn%2fposts%2fcache-hit--cache-miss%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Các chính sách 'Dọn Dẹp' Cache on whatsapp" href="https://api.whatsapp.com/send?text=C%c3%a1c%20ch%c3%adnh%20s%c3%a1ch%20%27D%e1%bb%8dn%20D%e1%ba%b9p%27%20Cache%20-%20https%3a%2f%2fblog.nagih.io.vn%2fposts%2fcache-hit--cache-miss%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Các chính sách 'Dọn Dẹp' Cache on telegram" href="https://telegram.me/share/url?text=C%c3%a1c%20ch%c3%adnh%20s%c3%a1ch%20%27D%e1%bb%8dn%20D%e1%ba%b9p%27%20Cache&amp;url=https%3a%2f%2fblog.nagih.io.vn%2fposts%2fcache-hit--cache-miss%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Các chính sách 'Dọn Dẹp' Cache on ycombinator" href="https://news.ycombinator.com/submitlink?t=C%c3%a1c%20ch%c3%adnh%20s%c3%a1ch%20%27D%e1%bb%8dn%20D%e1%ba%b9p%27%20Cache&u=https%3a%2f%2fblog.nagih.io.vn%2fposts%2fcache-hit--cache-miss%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.nagih.io.vn/>Nagih | Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>